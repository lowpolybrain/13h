"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@13h/core");exports.FixedSprite=class{image;spriteNum;size;_sprite;spriteIndex=0;constructor(e,i,s){this.image=e,this.spriteNum=s,this.size=t.point.get(i),this._sprite=new t.Canvas(i),this.setSpriteIndex(0)}setSpriteIndex(t){this.spriteIndex=t,this._sprite.clear();const[e,i]=this.getSpriteNum();if(t<e*i&&t>=0){const[i,s]=this.size,r=t%e,n=Math.floor(t/e);this._sprite.context.drawImage(this.image.element,-r*i,-n*s)}return this}get lastFrameIndex(){const[t,e]=this.getSpriteNum();return t*e-1}nextSprite(){const t=(this.spriteIndex+1)%this.lastFrameIndex;return this.setSpriteIndex(t),this}draw(t,e,i,s,r){return this._sprite.draw(t,e,i,s,r),this}getSpriteNum(){if(this.spriteNum)return this.spriteNum;const[t,e]=this.image.size;return[Math.floor(t/this.size[0]),Math.floor(e/this.size[1])]}getDebugCanvas(){const e=this.image instanceof t.Canvas?this.image.copy():this.image.createCanvas(),[i,s]=this.size,[r,n]=this.getSpriteNum(),h=i*r,o=s*n;for(let t=0;t<=r;t+=1){const s=t*i;e.line([s-.5,0],[s-.5,o],"#0f05",1),e.line([s+.5,0],[s+.5,o],"#f005",1)}for(let t=0;t<=n;t+=1){const i=t*s;e.line([0,i-.5],[h,i+.5],"#ff05",1),e.line([0,i+.5],[h,i+.5],"#00f5",1)}return e.text(r+"x"+n,[3,3],"#000"),e.text(r+"x"+n,[2.5,2.5],"#fff"),e}},exports.Image=class{url;_isReady=!1;element;_size=[0,0];_center=[0,0];_pivot=[0,0];get pivot(){return this._pivot}get size(){return this._size}get height(){return this._size[1]}get width(){return this._size[0]}get cx(){return this._size[0]/2}get cy(){return this._size[1]/2}get center(){return this._center}setSize([t,e]){return this._size=[t,e],this._center=[t/2,e/2],this.element.width=t,this.element.height=e,this}get isReady(){return this._isReady}onLoad=t.makeListener(!0,!0);onError=t.makeListener(!0,!0);constructor(t,e={}){this.url=t,this.element=document.createElement("img"),this.element.src=t,(e.crossOrigin||void 0===e.crossOrigin)&&(this.element.crossOrigin="Anonymous"),this.element.addEventListener("load",(()=>{this._isReady=!0;const{width:t,height:e}=this.element;this._size=[t,e],this._center=[t/2,e/2],this.onLoad.fire(this)})),this.element.addEventListener("error",(t=>this.onError.fire(t)))}draw(e,[i,s]=[0,0],r,n=1,h=1){const o=t.point.get(n);e.context.save();const[a,c]=this.pivot;return e.context.globalAlpha=h,r||o||r?((i||s)&&e.context.translate(i,s),r&&e.context.rotate(r),o&&e.context.scale(o[0],o[1]),e.context.translate(-a,-c),e.context.drawImage(this.element,0,0)):e.context.drawImage(this.element,i-a,s-c),e.context.restore(),this}createCanvas(e,i){const[s,r]=t.point.get(e),[n,h]=t.point.get(i,this.size),o=new t.Canvas([n-s,h-r]);return o.context.drawImage(this.element,-s,-r),o}};
